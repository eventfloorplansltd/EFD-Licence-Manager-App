<?phpinclude 'database_connection.php';check_login(); // <-- Security Checkif (!isset($input['userId']) || !isset($input['addonIds']) || !is_array($input['addonIds'])) {    send_error('Missing userId or addonIds array.');}$userId = (int)$input['userId'];$addonIds = array_map('intval', $input['addonIds']); // Sanitize all addon IDs// Use a transaction$conn->begin_transaction();try {    // 1. Delete all existing addons for this user    $stmt = $conn->prepare("DELETE FROM user_addons WHERE userId = ?");    $stmt->bind_param("i", $userId);    $stmt->execute();    $stmt->close();        // 2. Insert the new ones, if any    if (count($addonIds) > 0) {        $values = [];        foreach ($addonIds as $addonId) {            $values[] = "($userId, $addonId)";        }        $sql = "INSERT INTO user_addons (userId, addonId) VALUES " . implode(', ', $values);        $conn->query($sql);    }        // Commit the transaction    $conn->commit();        // Return the new list of assignments for this user    $result = $conn->query("SELECT * FROM user_addons WHERE userId = $userId");    $newAddonAssignments = [];    while($row = $result->fetch_assoc()) {        $row['id'] = (int)$row['id'];        $row['userId'] = (int)$row['userId'];        $row['addonId'] = (int)$row['addonId'];        $newAddonAssignments[] = $row;    }        send_json($newAddonAssignments);    } catch (mysqli_sql_exception $exception) {    $conn->rollback();    send_error('Error updating user addons: ' . $exception->getMessage(), 500);}$conn->close();?>